function sendmailaddvirtuser () {
    if [ `grep expect-devel /var/log/rpmpkgs | wc -l` -lt 1 ]; then
        echo -n "This script requires expect-devel. Install it[Y|n]:"
        read installexpectdevel
        if [ $installexpectdevel = "Y" ]; then
            up2date expect-devel || yum -y install expect-devel
        else
            break
        fi
    fi

    echo -n "Enter a list of comma separated email addresses:"
    read emailaddresses
    for address in `echo "$emailaddresses" | sed -e 's/\(, \|,\)/\n/g'`; do
        if [ `grep $address /etc/mail/virtusertable|wc -l` -gt 0 ]; then
            echo "$address exists in /etc/mail/virtusertable, exiting."
            break
        else
            echo "$address"
            echo -e "$address\t" "`echo \"$address\" | sed -e 's/@.*$//g'`" >> /etc/mail/virtusertable
        fi
    done

    for address in `echo "$emailaddresses" | sed -e 's/\(, \|,\)/\n/g' | sed -e 's/@.*$//g'`; do
        if [ `grep $address /etc/passwd|wc -l` -gt 0 ]; then
            echo "$address exists as a system user, exiting."
            break
        else
            echo $address
            useradd -s /bin/false "$address"
            PASSWD=`mkpasswd`
            echo "$PASSWD" | passwd --stdin "$address"
            echo $address:$PASSWD
        fi
    done
cd /etc/mail
make
}
sendmailaddvirtuser
